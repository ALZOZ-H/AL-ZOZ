<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AL ZOZ — Store</title>
  <style>
    body{font-family:Inter,Arial,sans-serif;background:#f7f8fb;margin:0}
    header{background:#111;color:#fff;padding:18px;display:flex;align-items:center;justify-content:space-between}
    .brand{font-weight:700;font-size:18px}
    .right{display:flex;gap:10px;align-items:center}
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn-login{background:#fff;color:#111}
    .btn-logout{background:#ff6600;color:#fff}
    main{padding:20px}
    .products{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px}
    .product{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.06);text-align:center}
    .product img{width:100%;height:160px;object-fit:cover;border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="brand">AL ZOZ — Life Savings, Not Just Products</div>
    <div class="right">
      <button id="loginLink" class="btn btn-login">Login</button>
      <button id="logoutBtn" class="btn btn-logout" style="display:none">Logout</button>
    </div>
  </header>

  <main>
    <div id="welcome" style="text-align:center;margin:26px 0;color:#4b5563">Please login to view products.</div>
    <div class="products" id="products"></div>
  </main>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBMcvOHM65rOqpZbwqSGI7LJm6lNc0dPo4",
      authDomain: "al-zoz-store.firebaseapp.com",
      projectId: "al-zoz-store",
      storageBucket: "al-zoz-store.firebasestorage.app",
      messagingSenderId: "977135794801",
      appId: "1:977135794801:web:43aae20e57879b8e9579d0",
      measurementId: "G-FG212CG4VE"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginLink = document.getElementById('loginLink');
    const logoutBtn = document.getElementById('logoutBtn');
    const productsDiv = document.getElementById('products');
    const welcome = document.getElementById('welcome');

    loginLink.addEventListener('click', () => { window.location.href = 'login.html'; });
    logoutBtn.addEventListener('click', () => { auth.signOut(); });

    auth.onAuthStateChanged(async user => {
      if(!user){
        logoutBtn.style.display = 'none';
        loginLink.style.display = 'inline-block';
        welcome.style.display = 'block';
        productsDiv.innerHTML = '';
        return;
      }

      loginLink.style.display = 'none';
      logoutBtn.style.display = 'inline-block';
      welcome.style.display = 'none';

      const email = (user.email || '').toLowerCase();
      if(email === 'alihomekh@gmail.com'){
        // admin user stays on admin.html — redirect
        window.location.href = 'admin.html';
        return;
      }

      // load products from Firestore
      productsDiv.innerHTML = '';
      try{
        const snap = await db.collection('products').get();
        if(snap.empty){
          productsDiv.innerHTML = '<div style="text-align:center;color:#64748b">No products yet — ask the admin to add some.</div>';
        }else{
          snap.forEach(doc => {
            const p = doc.data();
            const el = document.createElement('div');
            el.className = 'product';
            el.innerHTML = `
              <img src="${p.img || 'https://via.placeholder.com/400x300?text=No+image'}" alt="${p.name}">
              <h3 style="margin:12px 0 6px">${p.name}</h3>
              <div style="font-weight:700;color:#111">$${p.price}</div>
              <button style="margin-top:10px;padding:8px 10px;background:#ff6600;border-radius:8px;border:none;color:#fff;cursor:pointer">Add to cart</button>
            `;
            productsDiv.appendChild(el);
          });
        }
      }catch(e){
        productsDiv.innerHTML = '<div style="color:#cf2333;text-align:center">Failed to load products. Check Firestore rules.</div>';
        console.error(e);
      }
    });
  </script>
</body>
</html>
