<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AL ZOZ — Life Savings Store</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{--accent:#ff6a00}
    body{background:#f6f7fb}
    .brand{display:flex;align-items:center;gap:12px}
    .logo-img{height:44px}
    .hero{background:white;border-radius:12px;padding:28px;margin-top:20px;box-shadow:0 8px 30px rgba(10,20,40,0.06)}
    .badge-offer{position:absolute;top:12px;left:12px;background:#ff6a00;color:#fff;padding:6px 8px;border-radius:6px;font-weight:700}
    .product-card{position:relative}
    .cart-count{background:#dc3545;color:#fff;padding:4px 8px;border-radius:20px;font-weight:700}
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a <a class="navbar-brand" href="index.html">
  <img src="logo.png" alt="AL ZOZ Logo" height="40" class="logo-img">
</a>
        <div>
          <div style="font-weight:700">AL ZOZ</div>
          <div style="font-size:12px;color:#cfd8dc">Life Savings, Not Just Products</div>
        </div>
      </a>
      <div class="d-flex align-items-center">
        <a class="btn btn-outline-light btn-sm me-2" href="offers.html">Hot Offers</a>
        <a class="btn btn-outline-light btn-sm me-2" href="contact.html">Support</a>
        <button id="loginBtn" class="btn btn-light btn-sm me-2">Login</button>
        <button id="logoutBtn" class="btn btn-warning btn-sm me-2" style="display:none">Logout</button>
        <button id="cartBtn" class="btn btn-sm btn-outline-light">Cart <span id="cartCount" class="cart-count ms-2">0</span></button>
      </div>
    </div>
  </nav>

  <main class="container">
    <div class="hero">
      <h2>Welcome to AL ZOZ</h2>
      <p class="text-muted">Trusted, curated life-saving essentials. Sign in to view products.</p>
    </div>

    <section id="productsWrap" class="mt-4">
      <div id="products" class="row g-3"></div>
    </section>
  </main>

  <!-- Cart drawer modal -->
  <div class="modal fade" id="cartModal" tabindex="-1"><div class="modal-dialog modal-dialog-end"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Cart</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body" id="cartBody"></div>
    <div class="modal-footer"><strong class="me-auto">Total: $<span id="cartTotal">0.00</span></strong>
      <button class="btn btn-primary" id="checkoutBtn">Checkout (email)</button>
    </div>
  </div></div></div>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ---------- CONFIG ----------
    const firebaseConfig = {
      apiKey: "AIzaSyBMcvOHM65rOqpZbwqSGI7LJm6lNc0dPo4",
      authDomain: "al-zoz-store.firebaseapp.com",
      projectId: "al-zoz-store",
      storageBucket: "al-zoz-store.firebasestorage.app",
      messagingSenderId: "977135794801",
      appId: "1:977135794801:web:43aae20e57879b8e9579d0",
      measurementId: "G-FG212CG4VE"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ---------- UI elements ----------
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const productsEl = document.getElementById('products');
    const cartBtn = document.getElementById('cartBtn');
    const cartCount = document.getElementById('cartCount');
    const cartModal = new bootstrap.Modal(document.getElementById('cartModal'));
    const cartBody = document.getElementById('cartBody');
    const cartTotalEl = document.getElementById('cartTotal');

    // local cart (session)
    let cart = {}; function updateCartUI(){ 
      const qty = Object.values(cart).reduce((s,i)=>s+i.q,0); cartCount.innerText = qty;
    }

    // open login
    loginBtn.addEventListener('click', ()=> location.href = 'login.html');
    logoutBtn.addEventListener('click', ()=> auth.signOut());

    // cart modal
    cartBtn.addEventListener('click', ()=>{
      renderCart();
      cartModal.show();
    });
    function renderCart(){
      cartBody.innerHTML = '';
      let total = 0;
      if(Object.keys(cart).length===0) cartBody.innerHTML = '<div class="text-muted">Cart is empty</div>';
      else {
        Object.values(cart).forEach(item=>{
          total += item.price*item.q;
          const row = document.createElement('div');
          row.className = 'd-flex align-items-center justify-content-between mb-2';
          row.innerHTML = `<div><strong>${item.name}</strong><div class="text-muted small">$${item.price} x ${item.q}</div></div>
            <div><button class="btn btn-sm btn-outline-secondary me-1" onclick="chg(${item.id},-1)">-</button>
            <button class="btn btn-sm btn-outline-secondary" onclick="chg(${item.id},1)">+</button></div>`;
          cartBody.appendChild(row);
        });
      }
      cartTotalEl.innerText = total.toFixed(2);
    }
    function chg(id,delta){ if(!cart[id]) return; cart[id].q += delta; if(cart[id].q<=0) delete cart[id]; updateCartUI(); renderCart(); }

    document.getElementById('checkoutBtn').addEventListener('click', ()=>{
      if(Object.keys(cart).length===0){ alert('Cart is empty'); return; }
      const items = Object.values(cart).map(i=>`${i.name} x${i.q} — $${(i.price*i.q).toFixed(2)}`).join('\n');
      const total = Object.values(cart).reduce((s,i)=>s+i.price*i.q,0).toFixed(2);
      const body = encodeURIComponent(`Order from AL ZOZ:\n\n${items}\n\nTotal: $${total}\n\nCustomer info:\nName:\nAddress:\nPhone:\n`);
      window.location.href = `mailto:recipient@example.com?subject=AL ZOZ Order&body=${body}`;
    });

    // ---------- Auth state & loading ----------
    auth.onAuthStateChanged(async user=>{
      if(!user){
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        productsEl.innerHTML = '<div class="col-12 text-center text-muted py-5">Please <a href="login.html">login</a> to view products.</div>';
        return;
      }
      loginBtn.style.display = 'none';
      logoutBtn.style.display = 'inline-block';
      // admin redirect
      if(user.email && user.email.toLowerCase() === 'alihomekh@gmail.com'){ location.href = 'admin.html'; return; }
      // load products
      loadProducts();
    });

    async function loadProducts(){
      productsEl.innerHTML = '';
      try{
        const snap = await db.collection('products').orderBy('createdAt','desc').get();
        if(snap.empty){
          productsEl.innerHTML = '<div class="col-12 text-center text-muted py-5">No products yet.</div>'; return;
        }
        snap.forEach(doc=>{
          const p = doc.data(); const id = doc.id;
          const card = document.createElement('div'); card.className = 'col-sm-6 col-md-4 col-lg-3';
          card.innerHTML = `
            <div class="card product-card h-100">
              ${p.offer?'<div class="badge-offer">HOT</div>':''}
              <img src="${p.img||'https://via.placeholder.com/400x300'}" class="card-img-top" style="height:180px;object-fit:cover" alt="">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">${p.name}</h5>
                <p class="card-text fw-bold">$${p.price}</p>
                <div class="mt-auto"><button class="btn btn-sm btn-primary w-100" onclick="addToCart('${id}','${escape(p.name)}',${p.price})">Add to cart</button></div>
              </div>
            </div>`;
          productsEl.appendChild(card);
        });
      }catch(e){ console.error(e); productsEl.innerHTML = '<div class="col-12 text-danger">Failed to load products.</div>'; }
    }

    // add to cart (local)
    function addToCart(id,name,price){
      name = unescape(name);
      if(!cart[id]) cart[id] = {id,name,price,q:0};
      cart[id].q++;
      updateCartUI();
      alert('Added to cart');
    }

    // initial UI
    updateCartUI();
  </script>
</body>
</html>
