<!-- admin.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AL ZOZ — Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>body{background:#f4f6fb}.logo-img{height:40px}.card-admin{max-width:1100px;margin:30px auto;padding:20px;border-radius:12px}</style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark">
    <div class="container">
<a class="navbar-brand" href="index.html">
  <img src="logo.png" alt="AL ZOZ Logo" height="60" class="logo-img">
</a>
      <div><button id="logoutBtn" class="btn btn-warning btn-sm">Logout</button></div>
    </div>
  </nav>

  <div class="card card-admin">
    <h3>Admin Dashboard</h3>
    <p class="text-muted">Logged in as <strong>alihomekh@gmail.com</strong></p>

    <div class="row g-3">
      <div class="col-md-6">
        <h5>Add / Edit Product</h5>
        <input id="pid" type="hidden">
        <input id="pname" class="form-control mb-2" placeholder="Name">
        <input id="pprice" class="form-control mb-2" placeholder="Price (numbers only)">
        <input id="pimg" class="form-control mb-2" placeholder="Image URL">
        <div class="form-check mb-2"><input id="poffer" class="form-check-input" type="checkbox"><label class="form-check-label">Hot Offer</label></div>
        <div class="d-flex gap-2">
          <button id="saveBtn" class="btn btn-primary">Save Product</button>
          <button id="clearBtn" class="btn btn-outline-secondary">Clear</button>
        </div>
      </div>

      <div class="col-md-6">
        <h5>Products</h5>
        <div id="prodList" style="max-height:320px;overflow:auto;border-radius:8px;padding:8px;background:#fff;box-shadow:0 6px 18px rgba(2,6,23,0.04)"></div>
      </div>
    </div>

    <hr>
    <h5>Contact Messages</h5>
    <div id="messages" style="max-height:240px;overflow:auto;background:#fff;padding:10px;border-radius:8px"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBMcvOHM65rOqpZbwqSGI7LJm6lNc0dPo4",
      authDomain: "al-zoz-store.firebaseapp.com",
      projectId: "al-zoz-store",
      storageBucket: "al-zoz-store.firebasestorage.app",
      messagingSenderId: "977135794801",
      appId: "1:977135794801:web:43aae20e57879b8e9579d0",
      measurementId: "G-FG212CG4VE"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const logoutBtn = document.getElementById('logoutBtn');
    const pname = document.getElementById('pname'), pprice = document.getElementById('pprice'), pimg = document.getElementById('pimg'), poffer = document.getElementById('poffer'), pid = document.getElementById('pid');
    const saveBtn = document.getElementById('saveBtn'), clearBtn = document.getElementById('clearBtn'), prodList = document.getElementById('prodList'), messages = document.getElementById('messages');

    logoutBtn.onclick = ()=> auth.signOut();

    // protect admin
    auth.onAuthStateChanged(async user=>{
      if(!user) { location.href = 'login.html'; return; }
      if((user.email||'').toLowerCase() !== 'alihomekh@gmail.com'){ alert('Access denied'); location.href='index.html'; return; }
      loadProducts(); loadMessages();
    });

    // Save (create or update)
    saveBtn.addEventListener('click', async ()=>{
      const name = pname.value.trim(), price = parseFloat(pprice.value), img = pimg.value.trim(), offer = poffer.checked;
      if(!name || !price){ alert('Name and numeric price required'); return; }
      if(pid.value){
        await db.collection('products').doc(pid.value).update({ name, price, img, offer });
        pid.value=''; alert('Updated'); 
      } else {
        await db.collection('products').add({ name, price, img, offer, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
        alert('Added');
      }
      pname.value=''; pprice.value=''; pimg.value=''; poffer.checked=false;
      loadProducts();
    });

    clearBtn.addEventListener('click', ()=>{ pid.value=''; pname.value=''; pprice.value=''; pimg.value=''; poffer.checked=false; });

    async function loadProducts(){
      prodList.innerHTML = '';
      const snap = await db.collection('products').orderBy('createdAt','desc').get();
      snap.forEach(doc=>{
        const p = doc.data(); const id = doc.id;
        const el = document.createElement('div'); el.className='d-flex align-items-center justify-content-between mb-2';
        el.innerHTML = `<div><strong>${p.name}</strong><div class="small text-muted">$${p.price} ${p.offer?'<span class="badge bg-warning text-dark ms-2">HOT</span>':''}</div></div>
          <div class="btn-group btn-group-sm">
            <button class="btn btn-outline-primary" onclick="editProd('${id}')">Edit</button>
            <button class="btn btn-outline-danger" onclick="delProd('${id}')">Delete</button>
          </div>`;
        prodList.appendChild(el);
      });
    }

    window.editProd = async (id)=>{
      const doc = await db.collection('products').doc(id).get();
      const p = doc.data();
      pid.value = id; pname.value = p.name||''; pprice.value = p.price||''; pimg.value = p.img||''; poffer.checked = !!p.offer;
      window.scrollTo({top:0,behavior:'smooth'});
    };
    window.delProd = async (id)=>{
      if(!confirm('Delete product?')) return;
      await db.collection('products').doc(id).delete();
      loadProducts();
    };

    async function loadMessages(){
      messages.innerHTML = '';
      const snap = await db.collection('contacts').orderBy('createdAt','desc').get();
      if(snap.empty) messages.innerHTML = '<div class="text-muted">No messages.</div>';
      snap.forEach(doc=>{
        const m = doc.data();
        const el = document.createElement('div'); el.className='mb-2';
        el.innerHTML = `<div><strong>${m.name||'—'}</strong> <small class="text-muted">(${m.email||'—'})</small></div>
          <div class="small text-muted">${new Date(m.createdAt?.seconds?m.createdAt.seconds*1000:Date.now()).toLocaleString()}</div>
          <div class="mt-1">${(m.message||'')}</div><hr>`;
        messages.appendChild(el);
      });
    }
  </script>
</body>
</html>
